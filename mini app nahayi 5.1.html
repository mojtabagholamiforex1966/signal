<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سامانه سیگنال‌دهی VIP - نسخه حرفه‌ای</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #7209b7;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --vip: #9b59b6;
            --free: #f1c40f;
            --dark: #0f1721;
            --darker: #0a1018;
            --card-bg: rgba(30, 41, 59, 0.8);
            --card-border: rgba(67, 97, 238, 0.3);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --body-bg: linear-gradient(135deg, #0a1018, #1e293b);
            --text-light: #f8f9fa;
            --text-muted: #94a3b8;
            --shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
            --radius: 16px;
            --transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        * {
            transition: var(--transition);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--body-bg);
            color: var(--text-light);
            min-height: 100vh;
            padding-bottom: 50px;
            background-attachment: fixed;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* ================= هدر مدرن ================= */
        .dashboard-header {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            padding: 25px 0;
            border-radius: 0 0 30px 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            animation: slideDown 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }
        
        .dashboard-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(255,255,255,0.1) 0%, 
                rgba(255,255,255,0) 50%, 
                rgba(255,255,255,0.1) 100%);
            animation: shine 5s infinite;
        }
        
        /* ================= کارت‌های شیشه‌ای مدرن ================= */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: var(--radius);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 25px;
            animation: fadeIn 0.8s ease-out;
        }
        
        .glass-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border-color: rgba(67, 97, 238, 0.5);
        }
        
        .card-header {
            background: linear-gradient(to right, #4A00E0, #8E2DE2);
            color: white;
            font-weight: 700;
            padding: 18px 25px;
            border-bottom: none;
            font-size: 1.2rem;
            border-top-left-radius: var(--radius) !important;
            border-top-right-radius: var(--radius) !important;
        }
        
        .card-body {
            padding: 30px;
        }
        
        /* ================= سیگنال‌کارت‌های مدرن ================= */
        .signals-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .signal-card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--card-border);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            transform: translateY(0);
        }
        
        .signal-card:hover {
            transform: translateY(-7px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            border-color: var(--primary);
        }
        
        .signal-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
        }
        
        .signal-card.vip::before {
            background: linear-gradient(to right, var(--vip), #6a3093);
        }
        
        .signal-card.free::before {
            background: linear-gradient(to right, var(--free), #f39c12);
        }
        
        .signal-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .signal-card-title {
            font-weight: 700;
            font-size: 1.4rem;
            margin: 0;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .signal-card-title i {
            font-size: 1.8rem;
            color: var(--primary-light);
        }
        
        .signal-card-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }
        
        .signal-card-label {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 1rem;
        }
        
        .signal-card-value {
            font-weight: 700;
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        /* ================= دکمه‌های مدرن ================= */
        .btn-chart {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.4);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
        }
        
        .btn-chart:hover {
            background: linear-gradient(45deg, #3a56e0, #6519a8);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.6);
        }
        
        .btn-analysis {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition);
            margin: 25px auto 0;
            box-shadow: 0 5px 20px rgba(67, 97, 238, 0.4);
            font-size: 1.1rem;
            width: 100%;
        }
        
        .btn-analysis:hover {
            background: linear-gradient(45deg, #3a56e0, #6519a8);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.6);
        }
        
        /* ================= تب‌های مدرن ================= */
        .nav-tabs {
            border-bottom: 2px solid rgba(67, 97, 238, 0.2);
            padding: 0 10px;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #cbd5e1;
            font-weight: 600;
            padding: 15px 30px;
            border-radius: 50px;
            margin: 0 5px;
            background: rgba(255,255,255,0.05);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-tabs .nav-link:hover {
            background: rgba(67, 97, 238, 0.2);
            color: white;
            transform: translateY(-3px);
        }
        
        .nav-tabs .nav-link.active {
            color: white;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            box-shadow: 0 5px 20px rgba(67, 97, 238, 0.4);
            transform: translateY(-3px);
        }
        
        /* ================= افکت‌های ویژه ================= */
        .live-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background-color: var(--success);
            border-radius: 50%;
            margin-left: 8px;
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 15px var(--success);
        }
        
        .floating {
            animation: float 4s ease-in-out infinite;
        }
        
        .status-active {
            background-color: rgba(46, 204, 113, 0.15);
            color: var(--success);
            border: 1px solid rgba(46, 204, 113, 0.3);
            padding: 6px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 700;
        }
        
        /* ================= انیمیشن‌ها ================= */
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.7; }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ================= تاریخچه مدرن ================= */
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .history-grid-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 4px solid;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
        }
        
        .history-grid-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            border-color: var(--primary);
        }
        
        .history-grid-card.success {
            border-left-color: var(--success);
        }
        
        .history-grid-card.fail {
            border-left-color: var(--danger);
        }
        
        .history-grid-card.pending {
            border-left-color: var(--warning);
        }
        
        .history-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .history-symbol {
            font-weight: 700;
            font-size: 1.4rem;
            color: var(--text-light);
        }
        
        .history-status {
            font-weight: 600;
            padding: 6px 15px;
            border-radius: 50px;
            display: inline-block;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        
        .history-status.success {
            background: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }
        
        .history-status.fail {
            background: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }
        
        .history-status.pending {
            background: rgba(243, 156, 18, 0.15);
            color: var(--warning);
        }
        
        .history-profit {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
            text-align: center;
        }
        
        .history-profit.positive {
            color: var(--success);
        }
        
        .history-profit.negative {
            color: var(--danger);
        }
        
        /* ================= دکمه‌های ویژه ================= */
        .badge-vip {
            background: linear-gradient(45deg, var(--vip), #6a3093);
            color: white;
            font-weight: 700;
            padding: 8px 18px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .badge-free {
            background: linear-gradient(45deg, var(--free), #f39c12);
            color: #2d3436;
            font-weight: 700;
            padding: 8px 18px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        /* ================= مودال مدرن ================= */
        .modal-content {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            border: 1px solid var(--card-border);
            border-radius: var(--radius);
            overflow: hidden;
            backdrop-filter: blur(15px);
            box-shadow: var(--shadow);
        }
        
        .modal-header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-bottom: 1px solid var(--glass-border);
        }
        
        /* ================= صفحه احراز هویت مدرن ================= */
        .login-container {
            max-width: 450px;
            margin: 100px auto;
            padding: 40px 30px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            animation: fadeIn 1s ease-out;
        }
        
        .auth-form {
            padding: 25px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: var(--radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* ================= استایل‌های بخش چت ================= */
        #vip-chat-messages {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            height: 400px;
            overflow-y: auto;
        }
        
        .chat-message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 12px;
            animation: fadeIn 0.3s ease;
        }
        
        .user-message {
            background: rgba(67, 97, 238, 0.15);
            border-left: 3px solid var(--primary);
            margin-left: 30%;
        }
        
        .admin-message {
            background: rgba(155, 89, 182, 0.15);
            border-left: 3px solid var(--vip);
            margin-right: 30%;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }
        
        .message-user {
            font-weight: 600;
        }
        
        .message-time {
            color: var(--text-muted);
            font-size: 0.75rem;
        }
        
        .admin-badge {
            background: var(--vip);
            color: white;
            padding: 2px 8px;
            border-radius: 50px;
            font-size: 0.7rem;
            margin-right: 5px;
        }
        
        .message-text {
            line-height: 1.6;
        }
        
        .approve-btn {
            margin-top: 8px;
            font-size: 0.8rem;
            padding: 3px 8px;
        }
        
        /* انیمیشن */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* استایل‌های تحلیل تخصصی */
        .analysis-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        
        .analysis-content.expanded {
            max-height: 1000px;
        }
        
        .vip-analysis {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border: 1px solid rgba(67, 97, 238, 0.2);
        }
        
        .analysis-images {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .analysis-image {
            width: 100%;
            max-width: 300px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .analysis-image:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .analysis-image img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        
        .image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .vip-lock {
            position: relative;
        }
        
        .vip-lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 12px;
        }
        
        /* ================= استایل‌های جدید برای بخش تاریخچه پیشرفته ================= */
        .history-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .history-stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }

        .history-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .history-stat-title {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .history-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .history-table-container {
            overflow-x: auto;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 41, 59, 0.7);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .history-table th {
            background: rgba(67, 97, 238, 0.2);
            padding: 15px;
            text-align: right;
            font-weight: 600;
        }

        .history-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-table tr:last-child td {
            border-bottom: none;
        }

        .history-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .page-item {
            margin: 0 5px;
        }

        .page-link {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: var(--text-light);
            border-radius: 8px !important;
            padding: 8px 16px;
            transition: var(--transition);
        }

        .page-link:hover {
            background: rgba(67, 97, 238, 0.2);
            transform: translateY(-3px);
        }

        .page-item.active .page-link {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-color: transparent;
        }
        
        /* ================= استایل‌های جدید برای بخش مدیریت پرداخت‌ها ================= */
        .subscription-request-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--warning);
            position: relative;
        }
        
        .subscription-request-card.approved {
            border-left-color: var(--success);
        }
        
        .subscription-request-card.rejected {
            border-left-color: var(--danger);
        }
        
        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .request-status {
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-pending {
            background: rgba(243, 156, 18, 0.15);
            color: var(--warning);
        }
        
        .status-approved {
            background: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }
        
        .status-rejected {
            background: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }
        
        .request-images {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .request-image {
            width: 120px;
            height: 120px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
        }
        
        .request-image:hover {
            transform: scale(1.05);
        }
        
        .request-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-preview {
            position: relative;
            margin: 5px;
            display: inline-block;
        }
        
        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231,76,60,0.8);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s ease;
            z-index: 10;
        }
        
        .delete-btn:hover {
            background: rgba(231,76,60,1);
        }
        
        .delete-btn i {
            color: white;
            font-size: 0.8rem;
        }
        
        .image-preview img {
            max-width: 100px;
            height: auto;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .file-upload-area {
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }
        
        .payment-receipt-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* استایل‌های جدید برای بزرگنمایی تصاویر */
        .image-preview-modal .modal-dialog {
            max-width: 90%;
            max-height: 90vh;
        }
        
        .image-preview-modal .modal-body {
            padding: 0;
            text-align: center;
            background: rgba(0,0,0,0.9);
        }
        
        .image-preview-modal img {
            max-height: 80vh;
            max-width: 100%;
            object-fit: contain;
        }
        
        .preview-image {
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .preview-image:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .image-overlay {
            cursor: pointer;
        }
        
        /* ریسپانسیو */
        @media (max-width: 768px) {
            .signals-container {
                grid-template-columns: 1fr;
            }
            
            .history-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs .nav-link {
                padding: 12px 20px;
                font-size: 0.9rem;
            }
            
            .card-body {
                padding: 20px;
            }
            
            .login-container {
                margin: 50px auto;
                padding: 25px 20px;
            }
            
            .user-message, 
            .admin-message {
                margin-left: 0;
                margin-right: 0;
            }
            
            .analysis-images {
                flex-direction: column;
            }
            
            .history-stats,
            .history-filters {
                grid-template-columns: 1fr;
            }

            .history-table th,
            .history-table td {
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .request-image {
                width: 80px;
                height: 80px;
            }
            
            .image-preview-modal .modal-dialog {
                max-width: 95%;
            }
        }
        
        /* انیمیشن حذف تصویر */
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0); }
        }
        
        .fade-out {
            animation: fadeOut 0.3s forwards;
        }
        
        /* استایل‌های جدید برای بخش تیم */
        .team-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .team-member {
            background: rgba(30, 41, 59, 0.7);
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--card-border);
        }
        
        .team-member:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
        
        .team-member-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            margin: 0 auto 20px;
        }
        
        .team-member-name {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: var(--text-light);
        }
        
        .team-member-role {
            color: var(--primary-light);
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .team-member-desc {
            color: var(--text-muted);
            line-height: 1.8;
        }
        
        /* استایل‌های جدید برای بخش آمار ادمین */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-box {
            background: var(--glass-bg);
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
        }
        
        .stat-box.vip-stat {
            border-top: 4px solid var(--vip);
        }
        
        .stat-box.free-stat {
            border-top: 4px solid var(--free);
        }
        
        .stat-box.pending-stat {
            border-top: 4px solid var(--warning);
        }
        
        .stat-box.revenue-stat {
            border-top: 4px solid var(--success);
        }
        
        .stat-box i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 1.1rem;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            z-index: 9999;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideDown 0.5s ease-out;
        }
        
        .notification.alert-success {
            background: var(--success);
            border-left: 5px solid #27ae60;
        }
        
        .notification.alert-danger {
            background: var(--danger);
            border-left: 5px solid #c0392b;
        }
        
        .notification.alert-warning {
            background: var(--warning);
            border-left: 5px solid #d35400;
        }
        
        .notification.alert-info {
            background: var(--primary);
            border-left: 5px solid #2980b9;
        }
        
        .blurred-content {
            filter: blur(5px);
            pointer-events: none;
        }
        
        .admin-only {
            display: none;
        }

        /* استایل‌های جدید برای ویدیوها */
        .analysis-videos {
            margin-top: 20px;
        }

        .analysis-video {
            width: 100%;
            max-width: 500px;
            margin-bottom: 15px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .analysis-video video {
            width: 100%;
            height: auto;
            display: block;
        }

        .video-preview {
            position: relative;
            margin: 10px;
            display: inline-block;
        }

        .video-preview video {
            max-width: 150px;
            height: auto;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- صفحه احراز هویت -->
    <div id="authPage" class="login-container">
        <div class="text-center mb-4">
            <div class="floating" style="margin-bottom: 20px;">
                <i class="fas fa-chart-line fa-4x" style="color: var(--primary);"></i>
            </div>
            <h2 class="text-white">سامانه سیگنال‌دهی VIP</h2>
            <p class="text-light opacity-75">پلتفرم پیشرفته تحلیل و تریدینگ</p>
        </div>
        
        <ul class="nav nav-tabs auth-tabs mb-4" id="authTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab">ورود</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab">ثبت نام</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="forgot-tab" data-bs-toggle="tab" data-bs-target="#forgot" type="button" role="tab">فراموشی رمز</button>
            </li>
        </ul>
        
        <div class="tab-content">
            <!-- تب ورود -->
            <div class="tab-pane fade show active" id="login" role="tabpanel">
                <div class="auth-form">
                    <div class="mb-4">
                        <label class="form-label">نام کاربری یا ایمیل</label>
                        <input type="text" id="login-username" class="form-control" placeholder="نام کاربری یا ایمیل خود را وارد کنید" value="admin">
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">رمز عبور</label>
                        <input type="password" id="login-password" class="form-control" placeholder="رمز عبور خود را وارد کنید" value="pass123">
                    </div>
                    
                    <div class="mb-4 form-check">
                        <input type="checkbox" id="remember" class="form-check-input">
                        <label class="form-check-label" for="remember">مرا به خاطر بسپار</label>
                    </div>
                    
                    <button id="loginBtn" class="btn-analysis">
                        <i class="fas fa-sign-in-alt"></i> ورود به سامانه
                    </button>
                </div>
            </div>
            
            <!-- تب ثبت نام -->
            <div class="tab-pane fade" id="register" role="tabpanel">
                <div class="auth-form">
                    <div class="row mb-3">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">نام</label>
                            <input type="text" id="register-firstname" class="form-control" placeholder="نام خود را وارد کنید">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">نام خانوادگی</label>
                            <input type="text" id="register-lastname" class="form-control" placeholder="نام خانوادگی خود را وارد کنید">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">نام کاربری</label>
                        <input type="text" id="register-username" class="form-control" placeholder="نام کاربری دلخواه">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">ایمیل</label>
                        <input type="email" id="register-email" class="form-control" placeholder="ایمیل معتبر">
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">رمز عبور</label>
                            <input type="password" id="register-password" class="form-control" placeholder="حداقل 8 کاراکتر">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">تکرار رمز عبور</label>
                            <input type="password" id="register-confirm" class="form-control" placeholder="تکرار رمز عبور">
                        </div>
                    </div>
                    
                    <div class="mb-3 form-check">
                        <input type="checkbox" id="terms" class="form-check-input">
                        <label class="form-check-label" for="terms">
                            با <a href="#" class="text-primary">قوانین و مقررات</a> موافقم
                        </label>
                    </div>
                    
                    <button id="registerBtn" class="btn-analysis">
                        <i class="fas fa-user-plus"></i> ایجاد حساب کاربری
                    </button>
                </div>
            </div>
            
            <!-- تب فراموشی رمز -->
            <div class="tab-pane fade" id="forgot" role="tabpanel">
                <div class="auth-form">
                    <div class="mb-4">
                        <label class="form-label">ایمیل ثبت شده</label>
                        <input type="email" id="forgot-email" class="form-control" placeholder="ایمیل خود را وارد کنید">
                    </div>
                    
                    <div class="mb-4 alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> لینک بازیابی رمز عبور به ایمیل شما ارسال خواهد شد
                    </div>
                    
                    <button id="forgotBtn" class="btn-analysis">
                        <i class="fas fa-key"></i> بازیابی رمز عبور
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- داشبورد اصلی -->
    <div id="dashboard" style="display: none;">
        <!-- هدر داشبورد -->
        <header class="dashboard-header">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center flex-wrap">
                    <div class="text-center text-md-start mb-3 mb-md-0">
                        <h1 class="display-5"><i class="fas fa-chart-line me-3"></i>داشبورد سیگنال‌های VIP</h1>
                        <p class="mb-0 opacity-75">پایش لحظه‌ای بازارهای مالی جهانی</p>
                    </div>
                    <div class="text-center">
                        <div class="fs-5">وضعیت سامانه: 
                            <span class="text-success fw-bold">
                                فعال <span class="live-indicator"></span>
                            </span>
                        </div>
                        <div class="mt-2">
                            <span class="me-3">کاربر: <span id="current-user" class="fw-bold">مهمان</span></span>
                            <span>نوع حساب: <span id="account-type" class="badge-vip">VIP</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- تب‌های اصلی -->
            <div class="tab-container">
                <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="signals-tab" data-bs-toggle="tab" data-bs-target="#signals" type="button" role="tab">
                            <i class="fas fa-bolt"></i> سیگنال‌ها
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="team-tab" data-bs-toggle="tab" data-bs-target="#team" type="button" role="tab">
                            <i class="fas fa-users"></i> تیم ما
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="chat-tab" data-bs-toggle="tab" data-bs-target="#chat" type="button" role="tab">
                            <i class="fas fa-comments"></i> چت VIP
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="subscription-tab" data-bs-toggle="tab" data-bs-target="#subscription" type="button" role="tab">
                            <i class="fas fa-crown"></i> اشتراک VIP
                        </button>
                    </li>
                    <li class="nav-item admin-only" id="admin-tab-item">
                        <button class="nav-link" id="admin-tab" data-bs-toggle="tab" data-bs-target="#admin" type="button" role="tab">
                            <i class="fas fa-user-shield"></i> پنل ادمین
                        </button>
                    </li>
                    <li class="nav-item ms-auto" role="presentation">
                        <button class="nav-link text-danger" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> خروج
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="mainTabsContent">
                    <!-- تب سیگنال‌ها -->
                    <div class="tab-pane fade show active" id="signals" role="tabpanel">
                        <div class="glass-card mt-3">
                            <div class="card-header d-flex flex-column flex-md-row justify-content-between align-items-center">
                                <div class="d-flex align-items-center mb-3 mb-md-0">
                                    <i class="fas fa-bolt me-3"></i>
                                    <span>سیگنال‌های فعال بازار</span>
                                </div>
                                <div class="d-flex">
                                    <button class="btn btn-outline-light me-2" onclick="filterSignals('all')">
                                        <i class="fas fa-layer-group me-2"></i>همه
                                    </button>
                                    <button class="btn btn-outline-success me-2" onclick="filterSignals('VIP')">
                                        <i class="fas fa-crown me-2"></i>VIP
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="filterSignals('Free')">
                                        <i class="fas fa-star me-2"></i>Free
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="signals-container" id="signals-container">
                                    <!-- کارت‌های سیگنال به صورت پویا در اینجا نمایش داده می‌شوند -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- بخش جدید: تاریخچه و عملکرد سیستم -->
                        <div class="glass-card mt-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-history me-3"></i>
                                    <span>تاریخچه سیگنال‌ها</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- آمار کلی -->
                                <div class="history-stats" id="history-stats">
                                    <!-- آمار به صورت پویا -->
                                </div>
                                
                                <!-- فیلترهای پیشرفته -->
                                <div class="history-filters">
                                    <div>
                                        <label class="form-label">نوع سیگنال</label>
                                        <select id="history-type" class="form-select" onchange="applyHistoryFilters()">
                                            <option value="all">همه</option>
                                            <option value="VIP">VIP</option>
                                            <option value="Free">Free</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="form-label">وضعیت</label>
                                        <select id="history-status" class="form-select" onchange="applyHistoryFilters()">
                                            <option value="all">همه</option>
                                            <option value="success">موفق</option>
                                            <option value="fail">ناموفق</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="form-label">نماد</label>
                                        <input type="text" id="history-symbol" class="form-control" placeholder="جستجوی نماد" oninput="applyHistoryFilters()">
                                    </div>
                                    
                                    <div>
                                        <label class="form-label">بازه زمانی</label>
                                        <select id="history-time" class="form-select" onchange="applyHistoryFilters()">
                                            <option value="all">همه زمان‌ها</option>
                                            <option value="week">هفته اخیر</option>
                                            <option value="month">ماه اخیر</option>
                                            <option value="3month">۳ ماه اخیر</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- جدول تاریخچه -->
                                <div class="history-table-container">
                                    <table class="history-table">
                                        <thead>
                                            <tr>
                                                <th>نماد</th>
                                                <th>نوع</th>
                                                <th>وضعیت</th>
                                                <th>نوع معامله</th>
                                                <th>تاریخ</th>
                                                <th>سود/ضرر</th>
                                            </tr>
                                        </thead>
                                        <tbody id="history-table-body">
                                            <!-- ردیف‌ها به صورت پویا -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- صفحه‌بندی -->
                                <div class="pagination" id="history-pagination">
                                    <!-- کنترل‌های صفحه‌بندی -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- تب تیم ما -->
                    <div class="tab-pane fade" id="team" role="tabpanel">
                        <div class="glass-card mt-3">
                            <div class="card-header">
                                <i class="fas fa-users"></i> تیم حرفه‌ای ما
                            </div>
                            <div class="card-body">
                                <div class="team-container">
                                    <!-- کارت‌های اعضای تیم -->
                                    <div class="team-member">
                                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="عضو تیم" class="team-member-img">
                                        <h4 class="team-member-name">محمد رضایی</h4>
                                        <div class="team-member-role">مدیر فنی</div>
                                        <p class="team-member-desc">تحلیلگر ارشد بازارهای مالی با ۱۰ سال سابقه در بازارهای جهانی</p>
                                    </div>
                                    <div class="team-member">
                                        <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="عضو تیم" class="team-member-img">
                                        <h4 class="team-member-name">فاطمه محمدی</h4>
                                        <div class="team-member-role">تحلیلگر ارشد</div>
                                        <p class="team-member-desc">متخصص در تحلیل تکنیکال و فاندامنتال بازارهای ارز دیجیتال</p>
                                    </div>
                                    <div class="team-member">
                                        <img src="https://randomuser.me/api/portraits/men/62.jpg" alt="عضو تیم" class="team-member-img">
                                        <h4 class="team-member-name">علی حسینی</h4>
                                        <div class="team-member-role">توسعه‌دهنده سیستم</div>
                                        <p class="team-member-desc">طراح و توسعه‌دهنده سیستم‌های معاملاتی خودکار و هوش مصنوعی</p>
                                    </div>
                                    <div class="team-member">
                                        <img src="https://randomuser.me/api/portraits/women/68.jpg" alt="عضو تیم" class="team-member-img">
                                        <h4 class="team-member-name">زهرا کریمی</h4>
                                        <div class="team-member-role">مدیر پشتیبانی</div>
                                        <p class="team-member-desc">پشتیبانی ۲۴ ساعته و پاسخگویی به سوالات کاربران VIP</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- تب چت VIP -->
                    <div class="tab-pane fade" id="chat" role="tabpanel">
                        <div class="glass-card mt-3 vip-only">
                            <div class="card-header">
                                <i class="fas fa-comments"></i> چت اختصاصی اعضای VIP
                            </div>
                            <div class="card-body">
                                <div id="vip-chat-messages" style="height: 400px; overflow-y: auto; margin-bottom: 20px; border: 1px solid rgba(0,0,0,0.1); padding: 15px; border-radius: 15px;">
                                    <!-- پیام‌ها به صورت پویا نمایش داده می‌شوند -->
                                </div>
                                
                                <div id="vip-chat-input" class="d-flex">
                                    <input type="text" id="chat-message" class="form-control me-2" placeholder="پیام شما...">
                                    <button class="btn btn-primary" onclick="sendMessage()">
                                        <i class="fas fa-paper-plane"></i> ارسال
                                    </button>
                                </div>
                                
                                <div class="mt-3 alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i> پیام‌ها پس از تایید ادمین نمایش داده می‌شوند
                                </div>
                            </div>
                        </div>
                        
                        <div id="upgrade-message" class="glass-card mt-3" style="display: none;">
                            <div class="card-body text-center py-5">
                                <div class="floating mb-4">
                                    <i class="fas fa-crown fa-4x text-warning"></i>
                                </div>
                                <h4 class="text-dark">دسترسی محدود!</h4>
                                <p class="text-muted">این بخش مخصوص کاربران VIP است. برای دسترسی به چت اختصاصی با تحلیلگران، اشتراک VIP تهیه کنید.</p>
                                <button class="btn btn-primary mt-3" onclick="showTab('subscription')">
                                    <i class="fas fa-gem me-2"></i>ارتقا به VIP
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- تب اشتراک VIP -->
                    <div class="tab-pane fade" id="subscription" role="tabpanel">
                        <div class="glass-card mt-3">
                            <div class="card-header">
                                <i class="fas fa-crown"></i> اشتراک ویژه VIP
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-5 mb-4 mb-lg-0">
                                        <div class="p-4 bg-light rounded-3 h-100">
                                            <h4 class="text-primary mb-4">مزایای اشتراک VIP:</h4>
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex align-items-center">
                                                    <i class="fas fa-bolt text-success me-3"></i>
                                                    <span>دریافت سیگنال‌های لحظه‌ای پیش از انتشار عمومی</span>
                                                </li>
                                                <li class="list-group-item d-flex align-items-center">
                                                    <i class="fas fa-comments text-info me-3"></i>
                                                    <span>دسترسی به چت اختصاصی با تحلیلگران</span>
                                                </li>
                                                <li class="list-group-item d-flex align-items-center">
                                                    <i class="fas fa-chart-line text-warning me-3"></i>
                                                    <span>تحلیل تخصصی بازار و پیشنهادات معاملاتی</span>
                                                </li>
                                                <li class="list-group-item d-flex align-items-center">
                                                    <i class="fas fa-headset text-danger me-3"></i>
                                                    <span>پشتیبانی 24 ساعته VIP</span>
                                                </li>
                                                <li class="list-group-item d-flex align-items-center">
                                                    <i class="fas fa-bell text-purple me-3"></i>
                                                    <span>نوتیفیکیشن فوری سیگنال‌ها</span>
                                                </li>
                                            </ul>
                                            
                                            <div class="mt-4">
                                                <h5 class="mb-3">روش پرداخت:</h5>
                                                <div class="payment-method">
                                                    <p class="fw-bold">کارت به کارت:</p>
                                                    <div class="bg-white p-3 rounded-2 mb-2">
                                                        <div class="fw-bold text-center">5859 8310 1234 1234</div>
                                                        <div class="text-center small">بانک ملت</div>
                                                    </div>
                                                    <p class="mb-0">به نام: <strong>شرکت سیگنال‌دهی VIP</strong></p>
                                                </div>
                                                
                                                <div class="payment-method">
                                                    <p class="fw-bold">ارز دیجیتال (TRX):</p>
                                                    <div class="bg-white p-3 rounded-2 mb-2">
                                                        <div class="fw-bold text-center">TJvXz5XZQ9XZQ9XZQ9XZQ9XZQ9X</div>
                                                        <div class="text-center small">شبکه: TRON (TRC20)</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-7">
                                        <div class="stat-card">
                                            <div class="card-header bg-primary text-white">
                                                <i class="fas fa-gem"></i> خرید اشتراک VIP
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-4">
                                                    <label class="form-label fw-bold">مدت اشتراک</label>
                                                    <div class="d-flex flex-wrap gap-3">
                                                        <div class="form-check flex-grow-1">
                                                            <input class="form-check-input" type="radio" name="subscription-plan" id="plan1" checked>
                                                            <label class="form-check-label d-block p-3 border rounded-2 w-100" for="plan1">
                                                                <div class="d-flex justify-content-between">
                                                                    <span class="fw-bold">1 ماهه</span>
                                                                    <span class="badge bg-success">پرفروش</span>
                                                                </div>
                                                                <div class="h4 mt-2">290,000 تومان</div>
                                                                <div class="small text-muted">روزانه 9,700 تومان</div>
                                                            </label>
                                                        </div>
                                                        <div class="form-check flex-grow-1">
                                                            <input class="form-check-input" type="radio" name="subscription-plan" id="plan2">
                                                            <label class="form-check-label d-block p-3 border rounded-2 w-100" for="plan2">
                                                                <div class="d-flex justify-content-between">
                                                                    <span class="fw-bold">3 ماهه</span>
                                                                    <span class="badge bg-danger">10% تخفیف</span>
                                                                </div>
                                                                <div class="h4 mt-2">790,000 تومان</div>
                                                                <div class="small text-muted">روزانه 8,800 تومان</div>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-4">
                                                    <label class="form-label fw-bold">روش پرداخت</label>
                                                    <select id="payment-method" class="form-select form-select-lg">
                                                        <option>کارت به کارت</option>
                                                        <option>ارز دیجیتال (TRX)</option>
                                                        <option>درگاه پرداخت آنلاین</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="mb-4">
                                                    <label class="form-label fw-bold">آپلود فیش پرداخت</label>
                                                    <div class="file-upload-area mt-3 p-4 text-center rounded-3" onclick="document.getElementById('receipt-upload').click()">
                                                        <i class="fas fa-cloud-upload-alt fa-2x mb-3" style="color: var(--primary);"></i>
                                                        <p class="mb-1">برای آپلود تصویر کلیک کنید</p>
                                                        <p class="small opacity-75">فرمت‌های مجاز: JPG, PNG (حداکثر 2 تصویر)</p>
                                                    </div>
                                                    <div id="receipt-preview" class="d-flex flex-wrap mt-3"></div>
                                                    <input type="file" id="receipt-upload" class="d-none" accept="image/*" multiple>
                                                </div>
                                                
                                                <button class="btn btn-primary w-100 btn-lg py-3" onclick="submitPayment()">
                                                    <i class="fas fa-shopping-cart me-2"></i> پرداخت و فعال‌سازی
                                                </button>
                                                
                                                <div class="mt-4 text-center text-muted">
                                                    <i class="fas fa-shield-alt me-2"></i>پس از پرداخت، اشتراک شما حداکثر طی 2 ساعت فعال می‌شود
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- تب پنل ادمین -->
                    <div class="tab-pane fade" id="admin" role="tabpanel">
                        <div class="admin-stats">
                            <div class="stat-box vip-stat">
                                <i class="fas fa-crown fa-2x"></i>
                                <div class="stat-value">38</div>
                                <div class="stat-label">کاربران VIP</div>
                            </div>
                            <div class="stat-box free-stat">
                                <i class="fas fa-users fa-2x"></i>
                                <div class="stat-value">142</div>
                                <div class="stat-label">کاربران رایگان</div>
                            </div>
                            <div class="stat-box pending-stat">
                                <i class="fas fa-hourglass-half fa-2x"></i>
                                <div class="stat-value">12</div>
                                <div class="stat-label">درخواست‌های در انتظار</div>
                            </div>
                            <div class="stat-box revenue-stat">
                                <i class="fas fa-wallet fa-2x"></i>
                                <div class="stat-value">24.8M</div>
                                <div class="stat-label">درآمد ماهانه (تومان)</div>
                            </div>
                        </div>
                        
                        <div class="glass-card mt-3">
                            <div class="card-header bg-danger text-white">
                                <i class="fas fa-bullhorn"></i> صدور سیگنال جدید
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">نماد معاملاتی</label>
                                            <input type="text" id="signal-symbol" class="form-control form-control-lg mb-3" placeholder="BTC/USDT">
                                        </div>
                                        
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold">قیمت ورود</label>
                                                <input type="number" id="entry-price" class="form-control" placeholder="61000">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold">قیمت هدف</label>
                                                <input type="number" id="target-price" class="form-control" placeholder="63500">
                                            </div>
                                        </div>
                                        
                                        <div class="row g-3 mb-4">
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold">نوع سیگنال</label>
                                                <select id="signal-type" class="form-select">
                                                    <option value="VIP">VIP</option>
                                                    <option value="Free">Free</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold">نوع معامله</label>
                                                <select id="trade-type" class="form-select">
                                                    <option value="خرید">خرید</option>
                                                    <option value="فروش">فروش</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">قیمت استاپ</label>
                                            <input type="number" id="stop-price" class="form-control form-control-lg" placeholder="59800">
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label class="form-label fw-bold">مدت اعتبار (ساعت)</label>
                                            <input type="number" id="signal-duration" class="form-control form-control-lg" placeholder="24" value="24">
                                        </div>
                                    </div>
                                </div>
                                
                                <button class="btn btn-danger w-100 btn-lg py-3" onclick="issueSignal()">
                                    <i class="fas fa-paper-plane me-2"></i> ارسال سیگنال
                                </button>
                                
                                <div class="mt-4" id="signal-result"></div>
                            </div>
                        </div>
                        
                        <div class="glass-card mt-4">
                            <div class="card-header bg-dark text-white">
                                <i class="fas fa-list"></i> مدیریت سیگنال‌های فعال
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="user-table">
                                        <thead>
                                            <tr>
                                                <th>نماد</th>
                                                <th>نوع</th>
                                                <th>تاریخ/زمان</th>
                                                <th>قیمت ورود</th>
                                                <th>هدف/استاپ</th>
                                                <th>مدت باقی‌مانده</th>
                                                <th>عملیات</th>
                                            </tr>
                                        </thead>
                                        <tbody id="active-signals-list">
                                            <!-- لیست سیگنال‌های فعال به صورت پویا -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass-card mt-4">
                            <div class="card-header bg-secondary text-white">
                                <i class="fas fa-history"></i> تاریخچه سیگنال‌ها
                            </div>
                            <div class="card-body">
                                <div class="history-grid" id="admin-history-grid">
                                    <!-- تاریخچه سیگنال‌ها به صورت پویا -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- بخش جدید: مدیریت درخواست‌های اشتراک VIP -->
                        <div class="glass-card mt-4">
                            <div class="card-header bg-info text-white">
                                <i class="fas fa-file-invoice-dollar"></i> مدیریت درخواست‌های اشتراک VIP
                            </div>
                            <div class="card-body">
                                <div class="payment-receipt-container" id="subscription-requests-container">
                                    <!-- درخواست‌های پرداخت به صورت پویا -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- بقیه تب‌ها (پشتیبانی و نظرات) -->
                </div>
            </div>
        </div>
    </div>

    <!-- مودال ویرایش تحلیل -->
    <div class="modal fade" id="analysisModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="analysisModalTitle">ویرایش تحلیل تخصصی</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <label class="form-label fw-bold">تحلیل تخصصی</label>
                        <textarea id="analysis-text" class="form-control" rows="8" placeholder="تحلیل خود را وارد کنید..."></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">تصاویر تحلیلی</label>
                        <div class="d-flex flex-wrap gap-3" id="image-preview-container">
                            <!-- تصاویر در اینجا نمایش داده می‌شوند -->
                        </div>
                        
                        <div class="file-upload-area mt-3 p-4 text-center rounded-3" onclick="document.getElementById('analysis-images').click()">
                            <i class="fas fa-cloud-upload-alt fa-2x mb-3" style="color: var(--primary);"></i>
                            <p class="mb-1">برای آپلود تصویر کلیک کنید</p>
                            <p class="small opacity-75">فرمت‌های مجاز: JPG, PNG (حداکثر 5 تصویر)</p>
                        </div>
                        <input type="file" id="analysis-images" class="d-none" accept="image/*" multiple>
                    </div>
                    
                    <!-- بخش جدید برای ویدیوها -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">ویدیوهای تحلیلی</label>
                        <div class="d-flex flex-wrap gap-3" id="video-preview-container">
                            <!-- ویدیوها در اینجا نمایش داده می‌شوند -->
                        </div>
                        
                        <div class="file-upload-area mt-3 p-4 text-center rounded-3" onclick="document.getElementById('analysis-videos').click()">
                            <i class="fas fa-video fa-2x mb-3" style="color: var(--primary);"></i>
                            <p class="mb-1">برای آپلود ویدیو کلیک کنید</p>
                            <p class="small opacity-75">فرمت‌های مجاز: MP4, MOV (حداکثر 100MB)</p>
                        </div>
                        <input type="file" id="analysis-videos" class="d-none" accept="video/*" multiple>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">انصراف</button>
                    <button type="button" class="btn btn-primary" onclick="saveAnalysis()">ذخیره تحلیل</button>
                </div>
            </div>
        </div>
    </div>

    <!-- مودال نمایش تصویر بزرگ -->
    <div class="modal fade image-preview-modal" id="imagePreviewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">پیش‌نمایش تصویر</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <img id="modalImagePreview" src="" alt="پیش‌نمایش تصویر" class="w-100">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>
            </div>
        </div>
    </div>

    <div class="footer text-center py-3 text-muted">
        سامانه سیگنال‌دهی VIP • نسخه ۲.۱ • تمامی حقوق محفوظ است © ۱۴۰۳
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ================= منطق اصلی برنامه =================
        // دیتابیس نمونه کاربران
        const users = [
            { id: 1, username: "admin", email: "mohammad@example.com", type: "admin", status: "active", signupDate: "1402/05/12", password: "pass123" },
            { id: 2, username: "فاطمه محمدی", email: "fatemeh@example.com", type: "vip", status: "active", signupDate: "1402/04/21", password: "pass123" },
            { id: 3, username: "علی حسینی", email: "ali@example.com", type: "free", status: "pending", signupDate: "1402/06/03", password: "pass123" },
            { id: 4, username: "زهرا کریمی", email: "zahra@example.com", type: "free", status: "active", signupDate: "1402/05/29", password: "pass123" },
            { id: 5, username: "رضا احمدی", email: "reza@example.com", type: "vip", status: "active", signupDate: "1402/03/15", password: "pass123" },
            { id: 6, username: "نازنین صفری", email: "nazanin@example.com", type: "free", status: "pending", signupDate: "1402/06/10", password: "pass123" }
        ];
        
        // سیگنال‌های فعال
        const activeSignals = [
            { 
                id: 1, 
                symbol: "BTC/USDT", 
                signalType: "VIP", 
                tradeType: "خرید", 
                entry: 61200, 
                target: 63500, 
                stop: 59800, 
                issueDate: "1403/02/20", 
                issueTime: "10:30",
                duration: 24,
                timeRemaining: "22 ساعت",
                analysis: "سیگنال خرید بر اساس شکست مقاومت تاریخی 60,000 دلار صادر شده است. حجم معاملات در این سطح به طور قابل توجهی افزایش یافته و RSI از محدوده اشباع خرید خارج شده است. هدف اول: 63,500 دلار، هدف دوم: 65,200 دلار. استاپ لاس: 59,800 دلار.",
                images: [
                    "https://images.unsplash.com/photo-1620336655055-b088a61b1d0a?q=80&w=1000",
                    "https://images.unsplash.com/photo-1620336655052-b088a61b1d0a?q=80&w=1000"
                ],
                videos: [
                    "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4"
                ]
            },
            { 
                id: 2, 
                symbol: "ETH/USDT", 
                signalType: "Free", 
                tradeType: "خرید", 
                entry: 3420, 
                target: 3650, 
                stop: 3320, 
                issueDate: "1403/02/19", 
                issueTime: "14:45",
                duration: 18,
                timeRemaining: "18 ساعت",
                analysis: "اتریوم پس از اصلاح سالم، سیگنال خرید صادر می‌کند. تقاطع میانگین متحرک 20 و 50 روزه صعودی بوده و حجم معاملات در حال افزایش است. هدف اول: 3,650 دلار، هدف دوم: 3,750 دلار. استاپ لاس: 3,320 دلار.",
                images: [
                    "https://images.unsplash.com/photo-1620336655052-b088a61b1d0a?q=80&w=1000"
                ],
                videos: []
            },
            { 
                id: 3, 
                symbol: "XAU/USD", 
                signalType: "VIP", 
                tradeType: "فروش", 
                entry: 2340, 
                target: 2310, 
                stop: 2360, 
                issueDate: "1403/02/18", 
                issueTime: "09:15",
                duration: 12,
                timeRemaining: "12 ساعت",
                analysis: "طلای جهانی به مقاومت قوی 2,340 دلار رسیده و نشانه‌های واگرایی نزولی در RSI مشاهده می‌شود. پیشنهاد فروش با هدف 2,310 دلار و استاپ لاس 2,360 دلار. این سیگنال کوتاه مدت است و اعتبار 12 ساعته دارد.",
                images: [],
                videos: [
                    "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4"
                ]
            },
            { 
                id: 4, 
                symbol: "SOL/USDT", 
                signalType: "Free", 
                tradeType: "خرید", 
                entry: 142.5, 
                target: 152.0, 
                stop: 138.0, 
                issueDate: "1403/02/17", 
                issueTime: "16:20",
                duration: 8,
                timeRemaining: "8 ساعت",
                analysis: "سولانا در کانال صعودی قرار دارد و با شکست مقاومت 145 دلار، هدف 152 دلار قابل دسترس است. استاپ لاس: 138 دلار.",
                images: [],
                videos: []
            },
            { 
                id: 5, 
                symbol: "EUR/USD", 
                signalType: "VIP", 
                tradeType: "خرید", 
                entry: 1.0850, 
                target: 1.0920, 
                stop: 1.0790, 
                issueDate: "1403/02/16", 
                issueTime: "11:10",
                duration: 36,
                timeRemaining: "36 ساعت",
                analysis: "یورو/دلار در سطح حمایتی قوی قرار دارد و انتظار بازگشت به سمت مقاومت 1.0920 را داریم. استاپ لاس: 1.0790.",
                images: [],
                videos: []
            }
        ];
        
        // تاریخچه سیگنال‌ها - با اطلاعات بیشتر
        const historicalSignals = [
            { symbol: "BTC/USDT", status: "success", profit: 3.8, date: "1403/02/15", time: "09:30", type: "VIP", tradeType: "خرید" },
            { symbol: "ETH/USDT", status: "success", profit: 2.5, date: "1403/02/14", time: "14:20", type: "VIP", tradeType: "خرید" },
            { symbol: "XAU/USD", status: "success", profit: 1.7, date: "1403/02/13", time: "10:45", type: "Free", tradeType: "فروش" },
            { symbol: "EUR/USD", status: "fail", profit: -1.2, date: "1403/02/12", time: "16:30", type: "VIP", tradeType: "خرید" },
            { symbol: "GBP/USD", status: "success", profit: 2.1, date: "1403/02/11", time: "11:15", type: "Free", tradeType: "فروش" },
            { symbol: "USD/JPY", status: "success", profit: 1.5, date: "1403/02/10", time: "13:40", type: "VIP", tradeType: "خرید" },
            { symbol: "ADA/USDT", status: "fail", profit: -0.8, date: "1403/02/09", time: "15:25", type: "Free", tradeType: "خرید" },
            { symbol: "DOT/USDT", status: "success", profit: 3.2, date: "1403/02/08", time: "09:10", type: "VIP", tradeType: "خرید" },
            { symbol: "XRP/USDT", status: "success", profit: 2.0, date: "1403/02/07", time: "14:50", type: "Free", tradeType: "خرید" },
            { symbol: "LTC/USDT", status: "fail", profit: -1.5, date: "1403/02/06", time: "10:05", type: "VIP", tradeType: "فروش" },
            { symbol: "BNB/USDT", status: "success", profit: 4.1, date: "1403/01/25", time: "11:20", type: "VIP", tradeType: "خرید" },
            { symbol: "DOGE/USDT", status: "success", profit: 2.8, date: "1403/01/20", time: "15:30", type: "Free", tradeType: "خرید" },
            { symbol: "TRX/USDT", status: "fail", profit: -0.5, date: "1403/01/15", time: "09:45", type: "VIP", tradeType: "خرید" },
            { symbol: "AVAX/USDT", status: "success", profit: 5.2, date: "1403/01/10", time: "13:15", type: "VIP", tradeType: "خرید" },
            { symbol: "MATIC/USDT", status: "success", profit: 3.5, date: "1403/01/05", time: "16:40", type: "Free", tradeType: "خرید" }
        ];
        
        // مدیریت وضعیت کاربر و لاگین
        let currentUser = null;
        
        // متغیرهای سیستم
        let currentAnalysisSignalId = null;
        let currentAnalysisImages = [];
        let currentAnalysisVideos = [];
        
        // ذخیره پیام‌های چت
        let vipChatMessages = [
            {
                id: 1,
                username: "مدیر سیستم",
                text: "به چت VIP خوش آمدید! لطفا سوالات خود را مطرح کنید.",
                approved: true,
                role: "admin",
                timestamp: new Date().getTime() - 3600000 // 1 hour ago
            },
            {
                id: 2,
                username: "تحلیلگر ارشد",
                text: "سیگنال جدید طلا در حال بررسی نهایی است. به زودی منتشر می‌شود.",
                approved: true,
                role: "admin",
                timestamp: new Date().getTime() - 1800000 // 30 min ago
            },
            {
                id: 3,
                username: "فاطمه محمدی",
                text: "آیا سیگنال BTC همچنان معتبر است؟",
                approved: true,
                role: "user",
                timestamp: new Date().getTime() - 1200000 // 20 min ago
            },
            {
                id: 4,
                username: "پشتیبانی",
                text: "بله، سیگنال BTC تا ۱۲ ساعت آینده معتبر است. هدف اول ۶۲,۸۰۰ می‌باشد.",
                approved: true,
                role: "admin",
                timestamp: new Date().getTime() - 600000 // 10 min ago
            }
        ];
        
        // درخواست‌های پرداخت اشتراک VIP
        const subscriptionRequests = [
            {
                id: 1,
                userId: 3,
                username: "علی حسینی",
                plan: "1 ماهه",
                amount: 290000,
                paymentMethod: "کارت به کارت",
                receiptImages: [
                    "https://images.unsplash.com/photo-1620336655055-b088a61b1d0a?q=80&w=1000",
                    "https://images.unsplash.com/photo-1620336655052-b088a61b1d0a?q=80&w=1000"
                ],
                status: "pending",
                date: "1403/02/20",
                time: "14:30"
            },
            {
                id: 2,
                userId: 4,
                username: "زهرا کریمی",
                plan: "3 ماهه",
                amount: 790000,
                paymentMethod: "ارز دیجیتال",
                receiptImages: [
                    "https://images.unsplash.com/photo-1620336655055-b088a61b1d0a?q=80&w=1000"
                ],
                status: "pending",
                date: "1403/02/19",
                time: "11:45"
            },
            {
                id: 3,
                userId: 6,
                username: "نازنین صفری",
                plan: "1 ماهه",
                amount: 290000,
                paymentMethod: "درگاه پرداخت آنلاین",
                receiptImages: [
                    "https://images.unsplash.com/photo-1620336655052-b088a61b1d0a?q=80&w=1000"
                ],
                status: "approved",
                date: "1403/02/18",
                time: "09:15"
            }
        ];

        // متغیرهای صفحه‌بندی تاریخچه
        let currentPage = 1;
        const itemsPerPage = 10;

        // تابع محاسبه آمار تاریخچه
        function calculateHistoryStats() {
            const total = historicalSignals.length;
            const success = historicalSignals.filter(s => s.status === 'success').length;
            const successRate = Math.round((success / total) * 100);
            const avgProfit = historicalSignals.reduce((sum, s) => sum + s.profit, 0) / total;
            
            return {
                total,
                success,
                successRate,
                avgProfit: avgProfit.toFixed(2)
            };
        }
        
        // تابع نمایش آمار تاریخچه
        function renderHistoryStats() {
            const statsContainer = document.getElementById("history-stats");
            if(!statsContainer) return;
            
            const stats = calculateHistoryStats();
            
            statsContainer.innerHTML = `
                <div class="history-stat-card">
                    <i class="fas fa-signal fa-2x text-primary"></i>
                    <div class="history-stat-value">${stats.total}</div>
                    <div class="history-stat-title">تعداد سیگنال‌ها</div>
                </div>
                <div class="history-stat-card">
                    <i class="fas fa-check-circle fa-2x text-success"></i>
                    <div class="history-stat-value">${stats.success}</div>
                    <div class="history-stat-title">سیگنال‌های موفق</div>
                </div>
                <div class="history-stat-card">
                    <i class="fas fa-percentage fa-2x text-info"></i>
                    <div class="history-stat-value">${stats.successRate}%</div>
                    <div class="history-stat-title">نرخ موفقیت</div>
                </div>
                <div class="history-stat-card">
                    <i class="fas fa-chart-line fa-2x text-warning"></i>
                    <div class="history-stat-value">${stats.avgProfit}%</div>
                    <div class="history-stat-title">میانگین سود</div>
                </div>
            `;
        }
        
        // تابع اعمال فیلترهای تاریخچه
        function applyHistoryFilters() {
            const typeFilter = document.getElementById('history-type').value;
            const statusFilter = document.getElementById('history-status').value;
            const symbolFilter = document.getElementById('history-symbol').value.toLowerCase();
            const timeFilter = document.getElementById('history-time').value;
            
            let filtered = historicalSignals;
            
            // فیلتر نوع
            if (typeFilter !== 'all') {
                filtered = filtered.filter(s => s.type === typeFilter);
            }
            
            // فیلتر وضعیت
            if (statusFilter !== 'all') {
                filtered = filtered.filter(s => s.status === statusFilter);
            }
            
            // فیلتر نماد
            if (symbolFilter) {
                filtered = filtered.filter(s => s.symbol.toLowerCase().includes(symbolFilter));
            }
            
            // فیلتر زمان
            const now = new Date();
            if (timeFilter !== 'all') {
                filtered = filtered.filter(s => {
                    // تبدیل تاریخ سیگنال به فرمت قابل مقایسه
                    const dateParts = s.date.split('/');
                    const signalDate = new Date(
                        parseInt(dateParts[0]) + 1300, 
                        parseInt(dateParts[1]) - 1, 
                        parseInt(dateParts[2])
                    );
                    
                    const diffTime = Math.abs(now - signalDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    switch(timeFilter) {
                        case 'week': return diffDays <= 7;
                        case 'month': return diffDays <= 30;
                        case '3month': return diffDays <= 90;
                        default: return true;
                    }
                });
            }
            
            // رندر جدول با داده‌های فیلتر شده
            renderHistoryTable(filtered);
            renderHistoryStats();
        }
        
        // تابع رندر جدول تاریخچه با صفحه‌بندی
        function renderHistoryTable(data) {
            const tableBody = document.getElementById("history-table-body");
            const pagination = document.getElementById("history-pagination");
            
            if (!tableBody || !pagination) return;
            
            tableBody.innerHTML = "";
            pagination.innerHTML = "";
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const paginatedData = data.slice(startIndex, startIndex + itemsPerPage);
            
            // رندر ردیف‌های جدول
            paginatedData.forEach(signal => {
                const row = document.createElement("tr");
                
                row.innerHTML = `
                    <td>${signal.symbol}</td>
                    <td>
                        ${signal.type === "VIP" ? 
                            '<span class="badge-vip"><i class="fas fa-crown"></i> VIP</span>' : 
                            '<span class="badge-free"><i class="fas fa-star"></i> Free</span>'}
                    </td>
                    <td>
                        <span class="history-status ${signal.status}">
                            ${signal.status === "success" ? "موفق" : "ناموفق"}
                        </span>
                    </td>
                    <td>
                        <i class="fas ${signal.tradeType === 'خرید' ? 'fa-arrow-up text-success' : 'fa-arrow-down text-danger'}"></i>
                        ${signal.tradeType}
                    </td>
                    <td>${signal.date} ${signal.time}</td>
                    <td class="${signal.profit > 0 ? 'text-success' : 'text-danger'} fw-bold">
                        ${signal.profit > 0 ? '+' : ''}${signal.profit}%
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // رندر صفحه‌بندی
            const pageCount = Math.ceil(data.length / itemsPerPage);
            
            if (pageCount > 1) {
                // دکمه قبلی
                const prevLi = document.createElement("li");
                prevLi.className = "page-item";
                prevLi.innerHTML = `
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})" aria-label="قبلی">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                `;
                prevLi.disabled = currentPage === 1;
                pagination.appendChild(prevLi);
                
                // صفحات
                for (let i = 1; i <= pageCount; i++) {
                    const pageLi = document.createElement("li");
                    pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                    pageLi.innerHTML = `
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    `;
                    pagination.appendChild(pageLi);
                }
                
                // دکمه بعدی
                const nextLi = document.createElement("li");
                nextLi.className = "page-item";
                nextLi.innerHTML = `
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})" aria-label="بعدی">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                `;
                nextLi.disabled = currentPage === pageCount;
                pagination.appendChild(nextLi);
            }
        }
        
        // تابع تغییر صفحه
        function changePage(page) {
            if (page < 1) return;
            
            const filteredData = getFilteredHistory();
            const pageCount = Math.ceil(filteredData.length / itemsPerPage);
            
            if (page > pageCount) return;
            
            currentPage = page;
            renderHistoryTable(filteredData);
        }
        
        // تابع دریافت داده‌های فیلتر شده تاریخچه
        function getFilteredHistory() {
            const typeFilter = document.getElementById('history-type').value;
            const statusFilter = document.getElementById('history-status').value;
            const symbolFilter = document.getElementById('history-symbol').value.toLowerCase();
            const timeFilter = document.getElementById('history-time').value;
            
            let filtered = historicalSignals;
            
            // فیلتر نوع
            if (typeFilter !== 'all') {
                filtered = filtered.filter(s => s.type === typeFilter);
            }
            
            // فیلتر وضعیت
            if (statusFilter !== 'all') {
                filtered = filtered.filter(s => s.status === statusFilter);
            }
            
            // فیلتر نماد
            if (symbolFilter) {
                filtered = filtered.filter(s => s.symbol.toLowerCase().includes(symbolFilter));
            }
            
            // فیلتر زمان
            const now = new Date();
            if (timeFilter !== 'all') {
                filtered = filtered.filter(s => {
                    // تبدیل تاریخ سیگنال به فرمت قابل مقایسه
                    const dateParts = s.date.split('/');
                    const signalDate = new Date(
                        parseInt(dateParts[0]) + 1300, 
                        parseInt(dateParts[1]) - 1, 
                        parseInt(dateParts[2])
                    );
                    
                    const diffTime = Math.abs(now - signalDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    switch(timeFilter) {
                        case 'week': return diffDays <= 7;
                        case 'month': return diffDays <= 30;
                        case '3month': return diffDays <= 90;
                        default: return true;
                    }
                });
            }
            
            return filtered;
        }

        // تابع نمایش پیام‌های چت
        function renderChatMessages() {
            const chatContainer = document.getElementById("vip-chat-messages");
            if(!chatContainer) return;
            
            chatContainer.innerHTML = "";
            
            vipChatMessages.forEach(msg => {
                // فقط پیام‌های تایید شده را نمایش بده
                if(!msg.approved && currentUser.type !== "admin") return;
                
                const messageElement = document.createElement("div");
                messageElement.className = `chat-message ${msg.role === "admin" ? "admin-message" : "user-message"}`;
                
                // فرمت زمان: ساعت و دقیقه
                const date = new Date(msg.timestamp);
                const timeString = date.toLocaleTimeString('fa-IR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                messageElement.innerHTML = `
                    <div class="message-header">
                        <span class="message-user">${msg.username}</span>
                        <span class="message-time">${timeString}</span>
                        ${msg.role === "admin" ? '<span class="admin-badge">مدیر</span>' : ''}
                    </div>
                    <div class="message-text">${msg.text}</div>
                    ${currentUser && currentUser.type === "admin" && !msg.approved ? 
                        `<button class="btn btn-sm btn-success approve-btn" onclick="approveMessage(${msg.id})">
                            <i class="fas fa-check"></i> تایید
                        </button>` : ''
                    }
                `;
                
                chatContainer.appendChild(messageElement);
            });
            
            // اسکرول به پایین
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // تابع ارسال پیام جدید
        function sendMessage() {
            const messageInput = document.getElementById("chat-message");
            const messageText = messageInput.value.trim();
            
            if(!messageText) return;
            
            // ایجاد پیام جدید
            const newMessage = {
                id: vipChatMessages.length + 1,
                username: currentUser.username,
                text: messageText,
                approved: currentUser.type === "admin", // ادمین‌ها نیازی به تایید ندارند
                role: currentUser.type === "admin" ? "admin" : "user",
                timestamp: new Date().getTime()
            };
            
            vipChatMessages.push(newMessage);
            messageInput.value = "";
            
            // رندر مجدد پیام‌ها
            renderChatMessages();
            
            // نمایش نوتیفیکیشن برای ادمین‌ها
            if(currentUser.type !== "admin") {
                showNotification("پیام شما پس از تایید مدیر نمایش داده خواهد شد", "info");
            }
        }

        // تابع تایید پیام توسط ادمین
        function approveMessage(messageId) {
            const messageIndex = vipChatMessages.findIndex(m => m.id === messageId);
            if(messageIndex === -1) return;
            
            vipChatMessages[messageIndex].approved = true;
            renderChatMessages();
            showNotification("پیام با موفقیت تایید شد", "success");
        }
        
        // تابع نمایش سیگنال‌ها به صورت کارت
        function renderSignals() {
            const signalsContainer = document.getElementById("signals-container");
            if(!signalsContainer) return;
            
            signalsContainer.innerHTML = "";
            
            activeSignals.forEach(signal => {
                const card = document.createElement("div");
                card.className = `signal-card ${signal.signalType.toLowerCase()}`;
                card.setAttribute("data-type", signal.signalType);
                
                // بررسی دسترسی کاربر به تحلیل
                const canViewAnalysis = currentUser && 
                    (currentUser.type === "vip" || 
                     currentUser.type === "admin" || 
                     signal.signalType === "Free");
                
                card.innerHTML = `
                    <div class="signal-card-header">
                        <div class="signal-card-title">
                            <i class="fab fa-bitcoin"></i>${signal.symbol}
                        </div>
                        <div>
                            ${signal.signalType === "VIP" ? 
                                '<span class="badge-vip"><i class="fas fa-crown"></i> VIP</span>' : 
                                '<span class="badge-free"><i class="fas fa-star"></i> Free</span>'}
                        </div>
                    </div>
                    
                    <div class="signal-card-body">
                        <div class="signal-card-row">
                            <span class="signal-card-label">نوع معامله:</span>
                            <span class="signal-card-value"><span class="status-active">${signal.tradeType}</span></span>
                        </div>
                        <div class="signal-card-row">
                            <span class="signal-card-label">قیمت ورود:</span>
                            <span class="signal-card-value">${signal.entry.toLocaleString()}</span>
                        </div>
                        <div class="signal-card-row">
                            <span class="signal-card-label">هدف قیمت:</span>
                            <span class="signal-card-value" style="color: var(--success)">${signal.target.toLocaleString()}</span>
                        </div>
                        <div class="signal-card-row">
                            <span class="signal-card-label">استاپ لاس:</span>
                            <span class="signal-card-value" style="color: var(--danger)">${signal.stop.toLocaleString()}</span>
                        </div>
                        <div class="signal-card-row">
                            <span class="signal-card-label">تاریخ صدور:</span>
                            <span class="signal-card-value">${signal.issueDate}</span>
                        </div>
                        <div class="signal-card-row">
                            <span class="signal-card-label">زمان صدور:</span>
                            <span class="signal-card-value">${signal.issueTime}</span>
                        </div>
                        <div class="signal-card-row">
                            <span class="signal-card-label">اعتبار:</span>
                            <span class="signal-card-value time-remaining">${signal.timeRemaining}</span>
                        </div>
                        
                        <button class="btn-analysis">
                            <i class="fas fa-chart-line me-2"></i>مشاهده تحلیل
                        </button>
                        
                        <div class="analysis-content">
                            ${canViewAnalysis ? `
                                <div class="vip-analysis">
                                    <h5><i class="fas fa-chart-line me-2"></i>تحلیل تخصصی</h5>
                                    <p>${signal.analysis}</p>
                                    
                                    ${signal.images && signal.images.length > 0 ? `
                                        <div class="analysis-images">
                                            ${signal.images.map(img => `
                                                <div class="analysis-image" onclick="previewImage('${img}')">
                                                    <img src="${img}" alt="تحلیل ${signal.symbol}" class="preview-image">
                                                    <div class="image-overlay">برای بزرگنمایی کلیک کنید</div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    ${signal.videos && signal.videos.length > 0 ? `
                                        <div class="analysis-videos">
                                            <h5><i class="fas fa-video me-2"></i>ویدیوهای تحلیلی</h5>
                                            ${signal.videos.map(video => `
                                                <div class="analysis-video">
                                                    <video controls>
                                                        <source src="${video}" type="video/mp4">
                                                        مرورگر شما از پخش ویدیو پشتیبانی نمی‌کند
                                                    </video>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            ` : `
                                <div class="vip-lock">
                                    <div class="vip-lock-overlay">
                                        <i class="fas fa-lock fa-3x mb-3 text-warning"></i>
                                        <h5 class="text-warning">دسترسی محدود!</h5>
                                        <p>این تحلیل مخصوص کاربران VIP است</p>
                                        <button class="btn btn-warning mt-2" onclick="showTab('subscription')">
                                            <i class="fas fa-crown me-2"></i>ارتقا به VIP
                                        </button>
                                    </div>
                                </div>
                            `}
                        </div>
                    </div>
                    
                    ${currentUser && currentUser.type === "admin" ? `
                    <div class="text-center mt-3">
                        <button class="btn btn-sm btn-info me-2" onclick="editAnalysis(${signal.id})">
                            <i class="fas fa-edit me-1"></i>ویرایش تحلیل
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSignal(${signal.id})">
                            <i class="fas fa-trash me-1"></i>حذف
                        </button>
                    </div>
                    ` : ''}
                `;
                
                signalsContainer.appendChild(card);
            });
            
            // اضافه کردن رویداد برای دکمه‌های تحلیل
            document.querySelectorAll('.btn-analysis').forEach(button => {
                button.addEventListener('click', function() {
                    const card = this.closest('.signal-card');
                    const analysisContent = card.querySelector('.analysis-content');
                    
                    // تغییر آیکون
                    const icon = this.querySelector('i');
                    icon.classList.toggle('fa-chart-line');
                    icon.classList.toggle('fa-chart-bar');
                    
                    // نمایش/پنهان کردن تحلیل
                    analysisContent.classList.toggle('expanded');
                    this.classList.toggle('expanded');
                });
            });
        }
        
        // تابع نمایش لیست سیگنال‌های فعال برای ادمین
        function renderActiveSignalsList() {
            const signalsList = document.getElementById("active-signals-list");
            if(!signalsList) return;
            
            signalsList.innerHTML = "";
            
            activeSignals.forEach(signal => {
                const row = document.createElement("tr");
                
                row.innerHTML = `
                    <td>${signal.symbol}</td>
                    <td>${signal.signalType === "VIP" ? 
                        '<span class="badge-vip"><i class="fas fa-crown"></i> VIP</span>' : 
                        '<span class="badge-free"><i class="fas fa-star"></i> Free</span>'}</td>
                    <td>${signal.issueDate}<br><small>${signal.issueTime}</small></td>
                    <td>${signal.entry.toLocaleString()}</td>
                    <td>
                        <span style="color: var(--success)">${signal.target.toLocaleString()}</span><br>
                        <span style="color: var(--danger)">${signal.stop.toLocaleString()}</span>
                    </td>
                    <td>${signal.timeRemaining}</td>
                    <td>
                        <button class="btn btn-sm btn-info me-1" onclick="editAnalysis(${signal.id})">
                            <i class="fas fa-edit"></i> تحلیل
                        </button>
                        <button class="btn btn-sm btn-success me-1" onclick="closeSignal(${signal.id}, 'success')">
                            <i class="fas fa-check"></i> TP
                        </button>
                        <button class="btn btn-sm btn-warning me-1" onclick="closeSignal(${signal.id}, 'fail')">
                            <i class="fas fa-times"></i> SL
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSignal(${signal.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                signalsList.appendChild(row);
            });
        }
        
        // صدور سیگنال جدید توسط ادمین
        function issueSignal() {
            const symbol = document.getElementById('signal-symbol').value;
            const signalType = document.getElementById('signal-type').value;
            const tradeType = document.getElementById('trade-type').value;
            const entry = parseFloat(document.getElementById('entry-price').value);
            const target = parseFloat(document.getElementById('target-price').value);
            const stop = parseFloat(document.getElementById('stop-price').value);
            const duration = parseInt(document.getElementById('signal-duration').value) || 24;
            
            if (!symbol || !entry || !target || !stop) {
                showNotification("لطفاً تمام فیلدها را پر کنید", "danger");
                return;
            }
            
            // ایجاد سیگنال جدید
            const newSignal = {
                id: activeSignals.length + 1,
                symbol: symbol,
                signalType: signalType,
                tradeType: tradeType,
                entry: entry,
                target: target,
                stop: stop,
                issueDate: new Date().toLocaleDateString('fa-IR'),
                issueTime: new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute:'2-digit'}),
                duration: duration,
                timeRemaining: `${duration} ساعت`,
                analysis: "تحلیل تخصصی برای این سیگنال هنوز اضافه نشده است.",
                images: [],
                videos: []
            };
            
            activeSignals.push(newSignal);
            
            // ایجاد افکت بصری
            const resultDiv = document.getElementById('signal-result');
            resultDiv.innerHTML = `
                <div class="alert alert-success d-flex align-items-center">
                    <i class="fas fa-check-circle fa-2x me-3"></i>
                    <div>
                        <h5>سیگنال با موفقیت صادر شد!</h5>
                        <div class="mt-2">
                            <span class="signal-badge ${signalType === 'VIP' ? 'badge-vip' : 'badge-free'} me-2">${signalType}</span>
                            ${symbol} | ${tradeType} | ${newSignal.issueDate} ${newSignal.issueTime}
                        </div>
                    </div>
                </div>
            `;
            
            // به‌روزرسانی لیست سیگنال‌ها
            renderSignals();
            renderActiveSignalsList();
            
            // شبیه‌سازی ارسال نوتیفیکیشن
            setTimeout(() => {
                showNotification(`سیگنال جدید ${symbol} برای کاربران ارسال شد`, "success");
            }, 2000);
        }
        
        // بستن سیگنال توسط ادمین (هنگام رسیدن به TP یا SL)
        function closeSignal(signalId, result) {
            // پیدا کردن سیگنال در لیست فعال
            const signalIndex = activeSignals.findIndex(s => s.id === signalId);
            if (signalIndex === -1) return;
            
            const signal = activeSignals[signalIndex];
            
            // محاسبه سود/زیان تصادفی
            let profit;
            if (result === "success") {
                profit = (Math.random() * 5 + 1).toFixed(1); // سود 1-6%
            } else {
                profit = -(Math.random() * 2 + 0.5).toFixed(1); // ضرر 0.5-2.5%
            }
            
            // اضافه کردن به تاریخچه
            historicalSignals.unshift({
                symbol: signal.symbol,
                status: result,
                profit: parseFloat(profit),
                date: signal.issueDate,
                time: signal.issueTime,
                type: signal.signalType,
                tradeType: signal.tradeType
            });
            
            // حذف از لیست فعال
            activeSignals.splice(signalIndex, 1);
            
            // به‌روزرسانی UI
            renderSignals();
            applyHistoryFilters();
            renderActiveSignalsList();
            
            // نمایش اعلان
            const resultText = result === "success" ? "تیک پروفیت (TP)" : "استاپ لاس (SL)";
            showNotification(`سیگنال ${signal.symbol} با ${resultText} بسته شد | نتیجه: ${profit}%`, 
                result === "success" ? "success" : "danger");
        }
        
        // حذف سیگنال توسط ادمین
        function deleteSignal(signalId) {
            // پیدا کردن سیگنال در لیست فعال
            const signalIndex = activeSignals.findIndex(s => s.id === signalId);
            if (signalIndex === -1) return;
            
            const signal = activeSignals[signalIndex];
            
            // حذف از لیست فعال
            activeSignals.splice(signalIndex, 1);
            
            // به‌روزرسانی UI
            renderSignals();
            renderActiveSignalsList();
            
            // نمایش اعلان
            showNotification(`سیگنال ${signal.symbol} حذف شد`, "warning");
        }
        
        // ویرایش تحلیل سیگنال
        function editAnalysis(signalId) {
            const signal = activeSignals.find(s => s.id === signalId);
            if (!signal) return;
            
            currentAnalysisSignalId = signalId;
            currentAnalysisImages = [...signal.images]; // تصاویر فعلی را نگه دارید
            currentAnalysisVideos = [...signal.videos]; // ویدیوهای فعلی را نگه دارید
            
            // پر کردن فرم ویرایش
            document.getElementById('analysis-text').value = signal.analysis;
            
            // پاک کردن پیش‌نمایش تصاویر قبلی
            const imageContainer = document.getElementById('image-preview-container');
            imageContainer.innerHTML = '';
            
            // نمایش تصاویر موجود
            if (signal.images && signal.images.length > 0) {
                signal.images.forEach(img => {
                    const imgElement = document.createElement('div');
                    imgElement.className = 'image-preview';
                    imgElement.innerHTML = `
                        <img src="${img}" alt="تحلیل" class="preview-image" onclick="previewImage('${img}')" 
                             style="max-width: 100px; height: auto; cursor: pointer">
                        <div class="delete-btn" onclick="removeImagePreview(this)">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
                    
                    imageContainer.appendChild(imgElement);
                });
            }
            
            // پاک کردن پیش‌نمایش ویدیوهای قبلی
            const videoContainer = document.getElementById('video-preview-container');
            videoContainer.innerHTML = '';
            
            // نمایش ویدیوهای موجود
            if (signal.videos && signal.videos.length > 0) {
                signal.videos.forEach(video => {
                    const videoElement = document.createElement('div');
                    videoElement.className = 'video-preview';
                    videoElement.innerHTML = `
                        <video controls style="max-width: 150px; height: auto; border-radius: 8px">
                            <source src="${video}" type="video/mp4">
                        </video>
                        <div class="delete-btn" onclick="removeVideoPreview(this)">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
                    
                    videoContainer.appendChild(videoElement);
                });
            }
            
            // نمایش مودال
            const modal = new bootstrap.Modal(document.getElementById('analysisModal'));
            modal.show();
        }
        
        // حذف تصویر از پیش‌نمایش
        function removeImagePreview(deleteBtn) {
            const previewContainer = deleteBtn.parentElement;
            previewContainer.classList.add('fade-out');
            
            setTimeout(() => {
                previewContainer.remove();
                
                // حذف تصویر از لیست فعلی
                const imgSrc = previewContainer.querySelector('img').src;
                const index = currentAnalysisImages.indexOf(imgSrc);
                if (index !== -1) {
                    currentAnalysisImages.splice(index, 1);
                }
            }, 300);
        }
        
        // حذف ویدیو از پیش‌نمایش
        function removeVideoPreview(deleteBtn) {
            const previewContainer = deleteBtn.parentElement;
            previewContainer.classList.add('fade-out');
            
            setTimeout(() => {
                previewContainer.remove();
                
                // حذف ویدیو از لیست فعلی
                const videoSrc = previewContainer.querySelector('source').src;
                const index = currentAnalysisVideos.indexOf(videoSrc);
                if (index !== -1) {
                    currentAnalysisVideos.splice(index, 1);
                }
            }, 300);
        }
        
        // مدیریت آپلود تصاویر تحلیل
        function setupAnalysisImageUpload() {
            const analysisImagesEl = document.getElementById('analysis-images');
            if (!analysisImagesEl) return;
            
            analysisImagesEl.addEventListener('change', function(e) {
                const files = e.target.files;
                const imageContainer = document.getElementById('image-preview-container');
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const imgElement = document.createElement('div');
                        imgElement.className = 'image-preview';
                        imgElement.innerHTML = `
                            <img src="${e.target.result}" alt="تحلیل جدید" class="preview-image" onclick="previewImage('${e.target.result}')" 
                                 style="max-width: 100px; height: auto; cursor: pointer">
                            <div class="delete-btn" onclick="removeImagePreview(this)">
                                <i class="fas fa-times"></i>
                            </div>
                        `;
                        
                        imageContainer.appendChild(imgElement);
                        
                        // ذخیره تصویر در لیست تصاویر فعلی برای تحلیل
                        currentAnalysisImages.push(e.target.result);
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // مدیریت آپلود ویدیوهای تحلیل
        function setupAnalysisVideoUpload() {
            const analysisVideosEl = document.getElementById('analysis-videos');
            if (!analysisVideosEl) return;
            
            analysisVideosEl.addEventListener('change', function(e) {
                const files = e.target.files;
                const videoContainer = document.getElementById('video-preview-container');
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const videoUrl = URL.createObjectURL(file);
                    
                    const videoElement = document.createElement('div');
                    videoElement.className = 'video-preview';
                    videoElement.innerHTML = `
                        <video controls style="max-width: 150px; height: auto; border-radius: 8px">
                            <source src="${videoUrl}" type="${file.type}">
                        </video>
                        <div class="delete-btn" onclick="removeVideoPreview(this)">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
                    
                    videoContainer.appendChild(videoElement);
                    currentAnalysisVideos.push(videoUrl);
                }
            });
        }
        
        // ذخیره تحلیل ویرایش شده
        function saveAnalysis() {
            if (currentAnalysisSignalId === null) return;
            
            const analysisText = document.getElementById('analysis-text').value;
            
            // پیدا کردن سیگنال
            const signalIndex = activeSignals.findIndex(s => s.id === currentAnalysisSignalId);
            if (signalIndex === -1) return;
            
            // به‌روزرسانی تحلیل و تصاویر و ویدیوها
            activeSignals[signalIndex].analysis = analysisText;
            activeSignals[signalIndex].images = [...currentAnalysisImages]; // ذخیره تصاویر
            activeSignals[signalIndex].videos = [...currentAnalysisVideos]; // ذخیره ویدیوها
            
            // به‌روزرسانی UI
            renderSignals();
            renderActiveSignalsList();
            
            // بستن مودال
            const modal = bootstrap.Modal.getInstance(document.getElementById('analysisModal'));
            modal.hide();
            
            showNotification("تحلیل با موفقیت ذخیره شد", "success");
        }
        
        // تابع مدیریت آپلود فیش پرداخت
        function handleReceiptUpload() {
            const fileInput = document.getElementById('receipt-upload');
            const previewContainer = document.getElementById('receipt-preview');
            
            if (!fileInput || !previewContainer) return;
            
            fileInput.addEventListener('change', function(e) {
                const files = e.target.files;
                previewContainer.innerHTML = '';
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const imgElement = document.createElement('div');
                        imgElement.className = 'image-preview me-2 mb-2';
                        imgElement.innerHTML = `
                            <img src="${e.target.result}" alt="فیش پرداخت" class="preview-image" onclick="previewImage('${e.target.result}')" 
                                 style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; cursor: pointer">
                            <div class="delete-btn" onclick="this.parentElement.remove()">
                                <i class="fas fa-times"></i>
                            </div>
                        `;
                        previewContainer.appendChild(imgElement);
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // تابع ارسال درخواست پرداخت
        function submitPayment() {
            if (!currentUser) {
                showNotification("لطفاً ابتدا وارد حساب کاربری خود شوید", "warning");
                return;
            }
            
            const plan = document.querySelector('input[name="subscription-plan"]:checked').nextElementSibling.querySelector('.fw-bold').textContent;
            const paymentMethod = document.getElementById('payment-method').value;
            const receiptImages = document.querySelectorAll('#receipt-preview img');
            
            if (receiptImages.length === 0) {
                showNotification("لطفاً فیش پرداخت را آپلود کنید", "warning");
                return;
            }
            
            // ایجاد درخواست پرداخت جدید
            const newRequest = {
                id: subscriptionRequests.length + 1,
                userId: currentUser.id,
                username: currentUser.username,
                plan: plan,
                amount: plan === "1 ماهه" ? 290000 : 790000,
                paymentMethod: paymentMethod,
                receiptImages: Array.from(receiptImages).map(img => img.src),
                status: "pending",
                date: new Date().toLocaleDateString('fa-IR'),
                time: new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute:'2-digit'})
            };
            
            subscriptionRequests.push(newRequest);
            
            // به‌روزرسانی پنل ادمین
            if (document.getElementById('subscription-requests-container')) {
                renderSubscriptionRequests();
            }
            
            showNotification("درخواست اشتراک VIP شما با موفقیت ثبت شد. پس از تایید ادمین، حساب شما ارتقا خواهد یافت.", "success");
        }
        
        // تابع نمایش درخواست‌های اشتراک VIP در پنل ادمین
        function renderSubscriptionRequests() {
            const container = document.getElementById('subscription-requests-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            subscriptionRequests.forEach(request => {
                const card = document.createElement('div');
                card.className = `subscription-request-card ${request.status}`;
                
                card.innerHTML = `
                    <div class="request-header">
                        <div>
                            <h5 class="mb-0">${request.username}</h5>
                            <div class="text-muted">${request.date} ${request.time}</div>
                        </div>
                        <span class="request-status status-${request.status}">
                            ${request.status === "pending" ? "در انتظار تایید" : 
                             request.status === "approved" ? "تایید شده" : "رد شده"}
                        </span>
                    </div>
                    
                    <div class="request-details">
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><strong>پلن:</strong> ${request.plan}</p>
                                <p class="mb-1"><strong>مبلغ:</strong> ${request.amount.toLocaleString()} تومان</p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><strong>روش پرداخت:</strong> ${request.paymentMethod}</p>
                                <p class="mb-1"><strong>وضعیت:</strong> 
                                    <span class="${request.status === "pending" ? "text-warning" : 
                                                 request.status === "approved" ? "text-success" : "text-danger"}">
                                        ${request.status === "pending" ? "در انتظار تایید" : 
                                         request.status === "approved" ? "تایید شده" : "رد شده"}
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="request-images">
                        ${request.receiptImages.map((img, index) => `
                            <div class="request-image" onclick="previewImage('${img}')">
                                <img src="${img}" alt="فیش پرداخت ${index + 1}" class="preview-image">
                            </div>
                        `).join('')}
                    </div>
                    
                    ${request.status === "pending" ? `
                    <div class="mt-3 d-flex justify-content-end">
                        <button class="btn btn-success me-2" onclick="approveSubscription(${request.id})">
                            <i class="fas fa-check me-1"></i> تایید
                        </button>
                        <button class="btn btn-danger" onclick="rejectSubscription(${request.id})">
                            <i class="fas fa-times me-1"></i> رد
                        </button>
                    </div>
                    ` : ''}
                `;
                
                container.appendChild(card);
            });
        }
        
        // تابع تایید درخواست اشتراک توسط ادمین
        function approveSubscription(requestId) {
            const requestIndex = subscriptionRequests.findIndex(r => r.id === requestId);
            if (requestIndex === -1) return;
            
            const request = subscriptionRequests[requestIndex];
            request.status = "approved";
            
            // پیدا کردن کاربر و ارتقا به VIP
            const userIndex = users.findIndex(u => u.id === request.userId);
            if (userIndex !== -1) {
                users[userIndex].type = "vip";
                
                // اگر کاربر فعلی همان کاربر ارتقا یافته است، به‌روزرسانی UI
                if (currentUser && currentUser.id === request.userId) {
                    currentUser.type = "vip";
                    document.getElementById('account-type').textContent = "VIP";
                    document.getElementById('account-type').className = 'badge-vip';
                    
                    // فعال کردن چت VIP
                    const chatContainer = document.getElementById("vip-chat-messages");
                    const chatInput = document.getElementById("vip-chat-input");
                    const upgradeMessage = document.getElementById("upgrade-message");
                    
                    chatContainer.classList.remove("blurred-content");
                    chatInput.style.display = "flex";
                    upgradeMessage.style.display = "none";
                }
            }
            
            // به‌روزرسانی لیست درخواست‌ها
            renderSubscriptionRequests();
            
            showNotification(`درخواست ${request.username} تایید شد و حساب کاربری به VIP ارتقا یافت`, "success");
        }
        
        // تابع رد درخواست اشتراک توسط ادمین
        function rejectSubscription(requestId) {
            const requestIndex = subscriptionRequests.findIndex(r => r.id === requestId);
            if (requestIndex === -1) return;
            
            subscriptionRequests[requestIndex].status = "rejected";
            renderSubscriptionRequests();
            
            showNotification(`درخواست اشتراک رد شد`, "warning");
        }
        
        // تابع نمایش تصویر در مودال بزرگ
        function previewImage(imageUrl) {
            const modalImage = document.getElementById('modalImagePreview');
            modalImage.src = imageUrl;
            const modal = new bootstrap.Modal(document.getElementById('imagePreviewModal'));
            modal.show();
        }
        
        function handleLogin() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            
            // یافتن کاربر
            const user = users.find(u => 
                (u.username === username || u.email === username) && 
                u.password === password
            );
            
            if(user) {
                currentUser = user;
                
                // نمایش داشبورد
                document.getElementById('authPage').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('current-user').textContent = currentUser.username;
                document.getElementById('account-type').textContent = currentUser.type;
                document.getElementById('account-type').className = currentUser.type === "vip" ? 
                    'badge-vip' : currentUser.type === "admin" ? 'badge-vip' : 'badge-free';
                
                // تنظیم وضعیت چت VIP
                const chatContainer = document.getElementById("vip-chat-messages");
                const chatInput = document.getElementById("vip-chat-input");
                const upgradeMessage = document.getElementById("upgrade-message");
                
                if (currentUser.type === "free") {
                    // برای کاربران رایگان، چت تار شده و دکمه ارتقا نمایش داده شود
                    if (chatContainer) chatContainer.classList.add("blurred-content");
                    if (chatInput) chatInput.style.display = "none";
                    if (upgradeMessage) upgradeMessage.style.display = "block";
                } else {
                    // برای VIP و ادمین، چت عادی
                    if (chatContainer) chatContainer.classList.remove("blurred-content");
                    if (chatInput) chatInput.style.display = "flex";
                    if (upgradeMessage) upgradeMessage.style.display = "none";
                }
                
                // نمایش سیگنال‌ها
                renderSignals();
                
                // نمایش تاریخچه
                renderHistoryStats();
                applyHistoryFilters();
                
                // نمایش پیام‌های چت
                renderChatMessages();
                
                // نمایش پنل ادمین برای کاربر admin
                const adminTabItem = document.getElementById('admin-tab-item');
                if (adminTabItem) {
                    if (currentUser.type === "admin") {
                        adminTabItem.classList.remove("admin-only");
                        renderActiveSignalsList();
                        renderSubscriptionRequests();
                    } else {
                        adminTabItem.classList.add("admin-only");
                    }
                }
                
                // نمایش نوتیفیکیشن خوش‌آمدگویی
                showNotification(`خوش آمدید ${currentUser.username}!<br>دسترسی: ${currentUser.type === 'admin' ? 'مدیر سیستم' : currentUser.type === 'vip' ? 'کاربر VIP' : 'کاربر Free'}`, "success");
            } else {
                showNotification("نام کاربری یا رمز عبور نادرست است", "danger");
            }
        }
        
        // ثبت نام کاربر جدید
        function handleRegister() {
            const firstname = document.getElementById('register-firstname').value;
            const lastname = document.getElementById('register-lastname').value;
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            
            if(!firstname || !lastname || !username || !email || !password) {
                showNotification("لطفاً تمام فیلدها را پر کنید", "danger");
                return;
            }
            
            if(password !== confirm) {
                showNotification("رمز عبور و تکرار آن مطابقت ندارند", "danger");
                return;
            }
            
            if(!document.getElementById('terms').checked) {
                showNotification("لطفاً با قوانین و مقررات موافقت کنید", "warning");
                return;
            }
            
            // ایجاد کاربر جدید
            const newUser = {
                id: users.length + 1,
                username: `${firstname} ${lastname}`,
                email,
                type: "free",
                status: "active",
                signupDate: new Date().toLocaleDateString('fa-IR'),
                password
            };
            
            users.push(newUser);
            showNotification("حساب کاربری با موفقیت ایجاد شد. لطفاً وارد شوید", "success");
            
            // بازگشت به صفحه ورود
            document.getElementById('login-tab').click();
        }
        
        // بازیابی رمز عبور
        function handleForgotPassword() {
            const email = document.getElementById('forgot-email').value;
            const user = users.find(u => u.email === email);
            
            if(user) {
                showNotification(`لینک بازیابی رمز عبور به ${email} ارسال شد`, "success");
            } else {
                showNotification("ایمیل وارد شده در سیستم وجود ندارد", "danger");
            }
        }
        
        function handleLogout() {
            currentUser = null;
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('authPage').style.display = 'block';
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
        }
        
        // فیلتر سیگنال‌ها
        function filterSignals(type) {
            const cards = document.querySelectorAll('.signal-card');
            cards.forEach(card => {
                if(type === 'all') {
                    card.style.display = '';
                } else {
                    card.style.display = card.getAttribute('data-type') === type ? '' : 'none';
                }
            });
        }
        
        // نمایش تب‌ها
        function showTab(tabId) {
            document.querySelector(`#${tabId}-tab`).click();
        }
        
        // نمایش اعلان
        function showNotification(message, type = "success") {
            const notification = document.createElement("div");
            notification.className = `notification alert alert-${type} border-0 rounded-0 mb-0`;
            
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${type === "success" ? "check-circle" : "exclamation-triangle"} fa-2x me-3"></i>
                    <div>${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // حذف اعلان پس از 5 ثانیه
            setTimeout(() => {
                notification.style.animation = "fadeOut 0.5s forwards";
                setTimeout(() => {
                    notification.remove();
                }, 500);
            }, 5000);
        }
        
        // ================= راه‌اندازی اولیه =================
        document.addEventListener('DOMContentLoaded', function() {
            // تنظیم تاریخ برای فیلترها
            const startDateEl = document.getElementById('start-date');
            const endDateEl = document.getElementById('end-date');
            
            if (startDateEl && endDateEl) {
                const today = new Date();
                const oneMonthAgo = new Date();
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                
                // تابع تبدیل تاریخ به فرمت YYYY-MM-DD
                const formatDate = (date) => {
                  const year = date.getFullYear();
                  const month = String(date.getMonth() + 1).padStart(2, '0');
                  const day = String(date.getDate()).padStart(2, '0');
                  return `${year}-${month}-${day}`;
                };
                
                startDateEl.value = formatDate(oneMonthAgo);
                endDateEl.value = formatDate(today);
            }
            
            // رندر اولیه سیگنال‌ها
            renderSignals();
            
            // رندر اولیه پیام‌های چت
            renderChatMessages();
            
            // مدیریت آپلود تصاویر تحلیل
            setupAnalysisImageUpload();
            
            // مدیریت آپلود ویدیوهای تحلیل
            setupAnalysisVideoUpload();
            
            // مدیریت آپلود فیش پرداخت
            handleReceiptUpload();
            
            // رویدادهای ورود/ثبت‌نام
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('registerBtn').addEventListener('click', handleRegister);
            document.getElementById('forgotBtn').addEventListener('click', handleForgotPassword);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
        });
    </script>
</body>
</html>